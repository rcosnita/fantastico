<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Routing engine</title>
    
    <link rel="stylesheet" href="../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> 
  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mvc.html" title="Model View Controller"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="request_response.html" title="Request lifecycle"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">fantastico 0.7.0-b140 documentation</a> &raquo;</li>
          <li><a href="features.html" accesskey="U">Fantastico features</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="routing-engine">
<h1>Routing engine</h1>
<img alt="../_images/routing_engine.png" src="../_images/routing_engine.png" />
<p>Fantastico routing engine is design by having extensibility in mind. Below you can find the list of concerns for routing engine:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Support multiple sources for routes.</li>
<li>Load all available routes.</li>
<li>Select the controller that can handle the request route (if any available).</li>
</ol>
</div></blockquote>
<dl class="class">
<dt id="fantastico.routing_engine.router.Router">
<em class="property">class </em><tt class="descclassname">fantastico.routing_engine.router.</tt><tt class="descname">Router</tt><big>(</big><em>settings_facade=&lt;class 'fantastico.settings.SettingsFacade'&gt;</em><big>)</big><a class="reference internal" href="../_modules/fantastico/routing_engine/router.html#Router"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>This class is used for registering all available routes by using all registered loaders.</p>
<dl class="method">
<dt id="fantastico.routing_engine.router.Router.get_loaders">
<tt class="descname">get_loaders</tt><big>(</big><big>)</big><a class="reference internal" href="../_modules/fantastico/routing_engine/router.html#Router.get_loaders"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Method used to retrieve all available loaders. If loaders are not currently instantiated they are by these method.
This method also supports multi threaded workers mode of wsgi with really small memory footprint. It uses an internal
lock so that it makes sure available loaders are instantiated only once per wsgi worker.</p>
</dd></dl>

<dl class="method">
<dt id="fantastico.routing_engine.router.Router.handle_route">
<tt class="descname">handle_route</tt><big>(</big><em>url</em>, <em>environ</em><big>)</big><a class="reference internal" href="../_modules/fantastico/routing_engine/router.html#Router.handle_route"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Method used to identify the given url method handler. It enrich the environ dictionary with a new entry that
holds a controller instance and a function to be executed from that controller.</p>
</dd></dl>

<dl class="method">
<dt id="fantastico.routing_engine.router.Router.register_routes">
<tt class="descname">register_routes</tt><big>(</big><big>)</big><a class="reference internal" href="../_modules/fantastico/routing_engine/router.html#Router.register_routes"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Method used to register all routes from all loaders. If the loaders are not yet initialized this method will first
load all available loaders and then it will register all available routes. Also, this method initialize available routes
only once when it is first invoked.</p>
</dd></dl>

</dd></dl>

<div class="section" id="routes-loaders">
<h2>Routes loaders</h2>
<p>Fantastico routing engine is designed so that routes can be loaded from multiple sources (database, disk locations, and others).
This give huge extensibility so that developers can use Fantastico in various scenarios:</p>
<blockquote>
<div><ul class="simple">
<li>Create a CMS that allows people to create new pages (mapping between page url / controller) is hold in database. Just by
adding a simple loader in which the business logic is encapsulated allows routing engine extension.</li>
<li>Create a blog that loads articles from disk.</li>
</ul>
</div></blockquote>
<p>I am sure you can find other use cases in which you benefit from this extension point.</p>
</div>
<div class="section" id="how-to-write-a-new-route-loader">
<h2>How to write a new route loader</h2>
<p>Before digging in further details see the RouteLoader class documentation below:</p>
<dl class="class">
<dt id="fantastico.routing_engine.routing_loaders.RouteLoader">
<em class="property">class </em><tt class="descclassname">fantastico.routing_engine.routing_loaders.</tt><tt class="descname">RouteLoader</tt><big>(</big><em>settings_facade</em><big>)</big><a class="reference internal" href="../_modules/fantastico/routing_engine/routing_loaders.html#RouteLoader"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>This class provides the contract that must be provided by each concrete implementation. Each route loader is responsible
for implementing its own business logic for loading routes.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">DummyRouteLoader</span><span class="p">(</span><span class="n">RouteLoader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings_facade</span><span class="p">):</span>
        <span class="n">self_settings_facade</span> <span class="o">=</span> <span class="n">settings_facade</span>

    <span class="k">def</span> <span class="nf">load_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;/index.html&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;http_verbs&quot;</span><span class="p">:</span> <span class="p">{</span>
                                            <span class="s">&quot;GET&quot;</span><span class="p">:</span> <span class="s">&quot;fantastico.plugins.static_assets.StaticAssetsController.resolve_text&quot;</span>
                                            <span class="p">}</span>
                                <span class="p">},</span>
                <span class="s">&quot;/images/image.png&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;http_verbs&quot;</span><span class="p">:</span> <span class="p">{</span>
                                            <span class="s">&quot;GET&quot;</span><span class="p">:</span> <span class="s">&quot;fantastico.plugins.static_assets.StaticAssetsController.resolve_binary&quot;</span>
                                            <span class="p">}</span>
                                     <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
<dl class="method">
<dt id="fantastico.routing_engine.routing_loaders.RouteLoader.load_routes">
<tt class="descname">load_routes</tt><big>(</big><big>)</big><a class="reference internal" href="../_modules/fantastico/routing_engine/routing_loaders.html#RouteLoader.load_routes"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>This method must be overriden by each concrete implementation so that all loaded routes can be handled by
fantastico routing engine middleware.</p>
</dd></dl>

</dd></dl>

<p>As you can, each concrete route loader receives in the constructor settings facade that can be used to access fantastico settings.
In the code example above, DummyRouteLoader maps a list of urls to a controller method that can be used to render it. Keep in
mind that a route loader is a stateless component and it can&#8217;t in anyway determine the wsgi environment in which it is used. In
addition this design decision also make sure clear separation of concerned is followed.</p>
<p>Once your <strong>RouteLoader</strong> implementation is ready you must register it into settings profile. The safest bet is to add it into
BaseSettings provider. For more information read <a class="reference internal" href="../get_started/settings.html"><em>Fantastico settings</em></a>.</p>
</div>
<div class="section" id="configuring-available-loaders">
<h2>Configuring available loaders</h2>
<p>You can find all available loaders for the framework configured in your settings profile. You can find below a sample
configuration of available loaders:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CustomSettings</span><span class="p">(</span><span class="n">BasicSettings</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">routes_loaders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&quot;fantastico.routing_engine.custom_loader.CustomLoader&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>The above configuration tells <strong>Fantastico routing engine</strong> that only CustomLoader is a source of routes. If you want to learn
more about multiple configurations please read <a class="reference internal" href="../get_started/settings.html"><em>Fantastico settings</em></a>.</p>
</div>
<div class="section" id="dummyrouteloader">
<h2>DummyRouteLoader</h2>
<dl class="class">
<dt id="fantastico.routing_engine.dummy_routeloader.DummyRouteLoader">
<em class="property">class </em><tt class="descclassname">fantastico.routing_engine.dummy_routeloader.</tt><tt class="descname">DummyRouteLoader</tt><big>(</big><em>settings_facade</em><big>)</big><a class="reference internal" href="../_modules/fantastico/routing_engine/dummy_routeloader.html#DummyRouteLoader"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>This class represents an example of how to write a route loader. <strong>DummyRouteLoader</strong> is available in all configurations
and it provides a single route to the routing engine: <em>/dummy/route/loader/test</em>. Integration tests rely on this loader
to be configured in each available profile.</p>
<dl class="method">
<dt id="fantastico.routing_engine.dummy_routeloader.DummyRouteLoader.display_test">
<tt class="descname">display_test</tt><big>(</big><em>request</em><big>)</big><a class="reference internal" href="../_modules/fantastico/routing_engine/dummy_routeloader.html#DummyRouteLoader.display_test"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>This method handles <strong>/dummy/route/loader/test route</strong>. It is expected to receive a response with status code 400.
We do this for being able to test rendering and also avoid false positive security scans messages.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="routing-middleware">
<h2>Routing middleware</h2>
<p><strong>Fantastico</strong> routing engine is designed as a standalone component. In order to be able to integrate it into Fantastico request
lifecycle (:doc:/features/request_response.) we need an adapter component.</p>
<dl class="class">
<dt id="fantastico.middleware.routing_middleware.RoutingMiddleware">
<em class="property">class </em><tt class="descclassname">fantastico.middleware.routing_middleware.</tt><tt class="descname">RoutingMiddleware</tt><big>(</big><em>app</em>, <em>router_cls=&lt;class 'fantastico.routing_engine.router.Router'&gt;</em><big>)</big><a class="reference internal" href="../_modules/fantastico/middleware/routing_middleware.html#RoutingMiddleware"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Class used to integrate routing engine fantastico component into request / response lifecycle. This middleware is 
responsible for:</p>
<ol class="arabic simple">
<li>instantiating the router component and make it available to other components / middlewares through WSGI environment.</li>
<li>register all configured fantastico loaders (<a class="reference internal" href="#fantastico.routing_engine.router.Router.get_loaders" title="fantastico.routing_engine.router.Router.get_loaders"><tt class="xref py py-func docutils literal"><span class="pre">fantastico.routing_engine.router.Router.get_loaders()</span></tt></a>).</li>
<li>register all available routes (<a class="reference internal" href="#fantastico.routing_engine.router.Router.register_routes" title="fantastico.routing_engine.router.Router.register_routes"><tt class="xref py py-func docutils literal"><span class="pre">fantastico.routing_engine.router.Router.register_routes()</span></tt></a>).</li>
<li>handle route requests (<a class="reference internal" href="#fantastico.routing_engine.router.Router.handle_route" title="fantastico.routing_engine.router.Router.handle_route"><tt class="xref py py-func docutils literal"><span class="pre">fantastico.routing_engine.router.Router.handle_route()</span></tt></a>).</li>
</ol>
<p>It is important to understand that routing middleware assume a <strong>WebOb request</strong> available into WSGI environ. Otherwise, 
<a class="reference internal" href="exceptions.html#fantastico.exceptions.FantasticoNoRequestError" title="fantastico.exceptions.FantasticoNoRequestError"><tt class="xref py py-class docutils literal"><span class="pre">fantastico.exceptions.FantasticoNoRequestError</span></tt></a> will be thrown. You can read more about request middleware 
at <a class="reference internal" href="request_response.html"><em>Request lifecycle</em></a>.</p>
</dd></dl>

</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>


    <div class="footer">
        &copy; Copyright 2013, Radu Viorel Cosnita.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42788125-1', 'rcosnita.github.io');
  ga('send', 'pageview');
</script>

  </body>
</html>